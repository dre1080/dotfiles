#!/usr/bin/env bash
{{ if .isWSL }}
set -e

cat << EOF | sudo tee /etc/wsl.conf >/dev/null
[boot]
systemd = true
command = mount --make-rshared /

[interop]
appendWindowsPath = false

[automount]
enabled = true
options = "metadata,umask=22,fmask=11"
EOF

USERPROFILE=$(wslpath "$(wslvar USERPROFILE)")
cat << EOF | tee "$USERPROFILE/.wslconfig" >/dev/null
[experimental]
autoMemoryReclaim = dropcache
sparseVhd = true

[wsl2]
guiApplications = false
EOF
{{ end }}
